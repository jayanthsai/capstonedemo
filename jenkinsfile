pipeline {
   agent any
   stages{
      stage('git clone'){
	      steps {
		      git branch: 'master',
                credentialsId: '03daf977-4845-423e-9fb7-940c7dd52c03',
                url: 'https://github.com/jayanthsai/capstonedemo.git'
		  }
	  }
	  stage ('sonar analysis'){
	      steps{
		  script{
		      bat '''
			  call sonar.bat
			  '''
			  
			  }
		  }
	  }
	  
	  stage ('docker build and push image'){
	       steps{
		     script {
			  withCredentials([usernamePassword(credentialsId: 'docker', passwordVariable: 'PASSWORD', usernameVariable: 'USERNAME')]) {
			   bat '''
			     docker version
				 docker build -t helloworldservice/${BUILD_NUMBER} service1/.
				 docker build -t welcomeservice/${BUILD_NUMBER} service2/.
				 docker login --username=${USERNAME} --password=${PASSWORD}
				 docker push helloworldservice/${BUILD_NUMBER}
				 docker push welcomeservice/${BUILD_NUMBER}
			   '''
			 }
			 }
		   }
	  }
   }
}