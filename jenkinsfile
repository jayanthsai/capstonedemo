pipeline {
   agent any
   stages{
      stage('git clone'){
	      steps {
		      git branch: 'master',
                credentialsId: '03daf977-4845-423e-9fb7-940c7dd52c03',
                url: 'https://github.com/jayanthsai/capstonedemo.git'
		  }
	  }
	  stage ('sonar analysis'){
	      steps{
		  script{
		      bat '''
			  call sonar.bat
			  '''
			  
			  }
		  }
	  }
	  
	  stage ('docker build image service1'){
	       steps{
		     script {
			  withDockerRegistry(credentialsId: 'docker',  url: "") {
			  bat '''
                          cd service1
                          docker build -t integratordevops/helloservice1:%BUILD_NUMBER% .  
                          docker push integratordevops/helloservice1:%BUILD_NUMBER%
                          '''
			 }
			 }
		   }
	  }

          stage ('docker build image service2'){
	       steps{
		     script {
			  
			  bat '''
                          cd service2
                          docker build -t integratordevops/welcomeservice2:%BUILD_NUMBER% .  
                          docker push integratordevops/welcomeservice2:%BUILD_NUMBER%
                          '''
			 
			 }
		   }
	  }
        stage ('docker remove image') {
        steps{
            script{
                bat '''
                    docker rmi integratordevops/helloservice1:%BUILD_NUMBER%  
                    docker rmi integratordevops/welcomeservice2:%BUILD_NUMBER%
                    '''  
                }  
            }
}
   }
}